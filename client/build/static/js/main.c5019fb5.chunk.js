(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(19),s=n.n(c),i=(n(26),n(11)),o=n(2),l=(n(27),n(4)),u=n.n(l),d=n(9),j=n(5),b=n(0),h=Object(r.createContext)();var p=function(e){var t=Object(r.useState)(null),n=Object(j.a)(t,2),a=n[0],c=n[1],s=Object(r.useState)(null),i=Object(j.a)(s,2),o=i[0],l=i[1],u=Object(r.useState)(null),d=Object(j.a)(u,2),p=d[0],O=d[1],v={authValues:{userId:a,token:o,tokenExpiration:p},setAuthValues:function(e,t,n){c(e),l(t),O(n)},clearAuthValues:function(){c(null),l(null),O(null)}};return Object(b.jsx)(h.Provider,{value:v,children:e.children})},O=(n(30),"https://blablaevent-backend.herokuapp.com"),v=function(){var e=Object(r.useState)(""),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(""),s=Object(j.a)(c,2),i=s[0],o=s[1],l=Object(r.useState)(!1),p=Object(j.a)(l,2),v=p[0],m=p[1],x=Object(r.useContext)(h).setAuthValues,f=function(){var e=Object(d.a)(u.a.mark((function e(t){var r,a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),0!==n.trim().length&&0!==i.trim().length){e.next=3;break}return e.abrupt("return");case 3:return r={query:"\n        mutation CreateUser($email: String!, $password: String!){\n          createUser(userInput: {email: $email password: $password}) {\n            _id\n            email\n          }\n        }\n      ",variables:{email:n,password:i}},v&&(r={query:"\n          query Login($email: String!, $password: String!){\n            login(email: $email password: $password) {\n              userId\n              token\n              tokenExpiration\n            }\n          }\n        ",variables:{email:n,password:i}}),e.prev=5,e.next=8,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}});case 8:if(200===(a=e.sent).status||201===a.status){e.next=11;break}throw new Error("Failed request");case 11:return e.next=13,a.json();case 13:c=e.sent,v&&x(c.data.login.userId,c.data.login.token,c.data.login.tokenExpiration),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),console.log(e.t0);case 20:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{className:"auth-form-container",children:[Object(b.jsx)("h1",{className:"auth-heading",children:v?"Sign In":"Sign Up"}),Object(b.jsxs)("form",{className:"auth-form",onSubmit:f,children:[Object(b.jsxs)("div",{className:"auth-control",children:[Object(b.jsx)("label",{htmlFor:"email",children:"Email"}),Object(b.jsx)("input",{className:"auth-input",id:"email",type:"email",autoComplete:"off",value:n,onChange:function(e){return a(e.target.value)}})]}),Object(b.jsxs)("div",{className:"auth-control",children:[Object(b.jsx)("label",{htmlFor:"password",children:"Password"}),Object(b.jsx)("input",{className:"auth-input",id:"password",type:"password",value:i,onChange:function(e){return o(e.target.value)}})]}),Object(b.jsxs)("div",{className:"form-btns-container",children:[Object(b.jsx)("button",{className:"form-btn-submit btn-primary",type:"submit",children:v?"Sign In":"Sign Up"}),Object(b.jsxs)("button",{className:"form-btn-switch btn-secondary",type:"button",onClick:function(){return m((function(e){return!e}))},children:["Switch to ",v?"Sign Up":"Sign In"]})]})]})]})},m=n(21),x=function(e){var t=e.eventId,n=e.title,r=e.price,a=e.date,c=e.createdById,s=e.userId,i=e.viewDetailsHandler;return Object(b.jsxs)("li",{className:"events-list-item",children:[Object(b.jsxs)("div",{className:"event-item-data",children:[Object(b.jsx)("h1",{children:n}),Object(b.jsxs)("h2",{children:["\xa3",r.toFixed(2)]}),Object(b.jsx)("span",{children:a.substr(0,a.length-3)}),c===s&&Object(b.jsx)("span",{className:"event-user-owner",children:"You're the owner of this event"})]}),Object(b.jsx)("div",{className:"event-item-view-details",children:Object(b.jsx)("button",{className:"view-event-details btn-primary",onClick:function(){return i(t)},children:"View details"})})]})},f=function(e){var t=e.events,n=e.userId,r=e.showDetailsModal;return Object(b.jsx)("ul",{className:"events-list",children:t.map((function(e){return Object(b.jsx)(x,{eventId:e._id,title:e.title,price:e.price,date:e.date,createdById:e.createdBy._id,userId:n,viewDetailsHandler:r},e._id)}))})},g=(n(31),function(e){var t=e.children,n=e.title,r=e.canConfirm,a=e.onConfirm,c=e.onCancel,s=e.actionBtnText;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)("div",{className:"modal",children:[Object(b.jsx)("div",{className:"modal-title",children:Object(b.jsx)("h1",{children:n})}),Object(b.jsx)("section",{className:"modal-elements",children:t}),Object(b.jsxs)("section",{className:"modal-btns",children:[Object(b.jsx)("button",{className:"modal-cancel btn-secondary",onClick:c,children:r?"Cancel":"Close"}),r&&Object(b.jsx)("button",{className:"modal-confirm btn-primary",onClick:a,children:s})]})]}),Object(b.jsx)("div",{className:"backdrop"})]})}),k=(n(32),function(){var e=Object(r.useState)([]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!1),s=Object(j.a)(c,2),i=s[0],l=s[1],p=Object(r.useState)(null),v=Object(j.a)(p,2),x=v[0],k=v[1],y=Object(r.useContext)(h).authValues,N=Object(o.g)(),w=Object(r.useRef)(),C=Object(r.useRef)(),S=Object(r.useRef)(),I=Object(r.useRef)();Object(r.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={query:"\n          query {\n            events {\n              _id\n              title\n              description\n              price\n              date\n              createdBy {\n                _id\n              }\n            }\n          }\n        "},e.prev=1,e.next=4,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,c=r.data.events,a(c),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}})()()}),[]);var B=function(){var e=Object(d.a)(u.a.mark((function e(){var t,r,c,s,i,o,d,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=w.current.value,r=+C.current.value,c=S.current.value,s=I.current.value,!(0===t.trim().length||r<=0||0===c.trim().length||0===s.trim().length)){e.next=6;break}return e.abrupt("return");case 6:return i={query:"\n        mutation CreateEvent($title: String!, $price: Float!, $date: String!, $description: String!){\n          createEvent(eventInput: {title: $title price: $price date: $date description: $description}) {\n            _id\n            title\n            description\n            price\n            date\n            createdBy {\n              _id\n            }\n          }\n        }\n      ",variables:{title:t,price:r,date:c,description:s}},e.prev=7,e.next=10,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"application/json",Authorization:"Bearer "+y.token}});case 10:if(200===(o=e.sent).status||201===o.status){e.next=13;break}throw new Error("Failed request");case 13:return e.next=15,o.json();case 15:d=e.sent,j=d.data.createEvent,a([].concat(Object(m.a)(n),[j])),l(!1),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),console.log(e.t0);case 24:case"end":return e.stop()}}),e,null,[[7,21]])})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=Object(d.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.token){e.next=3;break}return N.push("/auth"),e.abrupt("return");case 3:return t={query:"\n        mutation BookEvent($eventId: ID!){\n          bookEvent(eventId: $eventId) {\n            _id\n          }\n        }\n      ",variables:{eventId:x._id}},e.prev=4,e.next=7,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+y.token}});case 7:if(200===(n=e.sent).status||201===n.status){e.next=10;break}throw new Error("Failed request");case 10:k(null),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(){return e.apply(this,arguments)}}();return Object(b.jsxs)(b.Fragment,{children:[i&&Object(b.jsx)(g,{title:"Create an event",onCancel:function(){return l(!1)},onConfirm:B,canConfirm:!0,actionBtnText:"Confirm",children:Object(b.jsxs)("form",{className:"create-event-form",children:[Object(b.jsxs)("div",{className:"create-event-form-control",children:[Object(b.jsx)("label",{htmlFor:"create-event-title",children:"Title"}),Object(b.jsx)("input",{id:"create-event-title",ref:w})]}),Object(b.jsxs)("div",{className:"create-event-form-control",children:[Object(b.jsx)("label",{htmlFor:"create-event-price",children:"Price"}),Object(b.jsx)("input",{id:"create-event-price",type:"number",ref:C})]}),Object(b.jsxs)("div",{className:"create-event-form-control",children:[Object(b.jsx)("label",{htmlFor:"create-event-date",children:"Date"}),Object(b.jsx)("input",{id:"create-event-date",type:"date",ref:S})]}),Object(b.jsxs)("div",{className:"create-event-form-control",children:[Object(b.jsx)("label",{htmlFor:"create-event-description",children:"Description"}),Object(b.jsx)("textarea",{id:"create-event-description",rows:4,ref:I})]})]})}),y.token&&Object(b.jsxs)("div",{className:"create-event-container",children:[Object(b.jsx)("p",{children:"Share your own events"}),Object(b.jsx)("button",{className:"btn-primary",onClick:function(){return l(!0)},children:"Create an event"})]}),x&&Object(b.jsx)(g,{title:"Event details",onCancel:function(){l(!1),k(null)},onConfirm:$,canConfirm:null!==y.userId&&x.createdBy._id!==y.userId,actionBtnText:"Book this event",children:Object(b.jsxs)("div",{className:"event-details",children:[Object(b.jsx)("h1",{children:x.title}),Object(b.jsxs)("h2",{children:["\xa3",x.price.toFixed(2)]}),Object(b.jsx)("p",{children:x.date.substr(0,x.date.length-3)}),Object(b.jsx)("p",{children:x.description})]})}),Object(b.jsx)(f,{events:n,userId:y.userId,showDetailsModal:function(e){var t=n.find((function(t){return t._id===e}));k(t)}})]})}),y=function(e){var t=e.bookingId,n=e.title,r=e.date,a=e.cancelBooking;return Object(b.jsxs)("li",{className:"bookings-list-item",children:[Object(b.jsxs)("div",{className:"booking-details",children:[Object(b.jsx)("span",{className:"booking-name",children:n}),Object(b.jsxs)("span",{children:["Event's date: ",r.substr(0,r.length-3)]})]}),Object(b.jsx)("button",{className:"cancel-booking btn-primary",onClick:function(){return a(t)},children:"Cancel booking"})]})},N=function(e){var t=e.bookings,n=e.onCancel;return Object(b.jsx)("ul",{className:"bookings-list",children:t.map((function(e){return Object(b.jsx)(y,{bookingId:e._id,title:e.event.title,date:e.event.date,cancelBooking:n},e._id)}))})},w=(n(41),function(){var e=Object(r.useState)([]),t=Object(j.a)(e,2),n=t[0],a=t[1],c=Object(r.useContext)(h).authValues;Object(r.useEffect)((function(){(function(){var e=Object(d.a)(u.a.mark((function e(){var t,n,r,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={query:"\n          query {\n            bookings {\n              _id\n              createdAt\n              event {\n                _id\n                title\n                date\n              }\n            }\n          }\n        "},e.prev=1,e.next=4,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token}});case 4:return n=e.sent,e.next=7,n.json();case 7:r=e.sent,s=r.data.bookings,a(s),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.log(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}})()()}),[c.token]);var s=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={query:"\n        mutation CancelBooking($bookingId: ID!) {\n          cancelBooking (bookingId: $bookingId) {\n            _id\n            title\n          }\n        }\n      ",variables:{bookingId:t}},e.prev=1,e.next=4,fetch(O+"/graphql",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+c.token}});case 4:a((function(e){return e.filter((function(e){return e._id!==t}))})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsxs)("div",{className:"bookings",children:[Object(b.jsx)("h1",{children:"Your bookings"}),Object(b.jsx)(N,{bookings:n,onCancel:s})]})}),C=(n(42),function(){var e=Object(r.useContext)(h),t=e.authValues,n=e.clearAuthValues,a=t.token;return Object(b.jsxs)("header",{className:"header",children:[Object(b.jsx)("div",{className:"header-brand",children:Object(b.jsx)(i.b,{to:"/",className:"header-brand-link",children:"BlaBlaEvent"})}),Object(b.jsxs)("nav",{className:"header-nav",children:[!a&&Object(b.jsx)(i.c,{to:"/auth",className:"nav-link",children:"Sign In"}),Object(b.jsx)(i.c,{to:"/events",className:"nav-link",children:"Events"}),a&&Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(i.c,{to:"/bookings",className:"nav-link",children:"Bookings"}),Object(b.jsx)("button",{className:"sign-out-btn",onClick:n,children:"Sign Out"})]})]})]})});var S=function(){var e=Object(r.useContext)(h).authValues.token;return Object(b.jsxs)(i.a,{children:[Object(b.jsx)(C,{}),Object(b.jsx)("main",{className:"main-content",children:Object(b.jsxs)(o.d,{children:[Object(b.jsx)(o.b,{exact:!0,path:"/",children:e?Object(b.jsx)(o.a,{to:"/events"}):Object(b.jsx)(o.a,{to:"/auth"})}),Object(b.jsx)(o.b,{path:"/auth",children:e?Object(b.jsx)(o.a,{to:"/events"}):Object(b.jsx)(v,{})}),Object(b.jsx)(o.b,{path:"/events",children:Object(b.jsx)(k,{})}),Object(b.jsx)(o.b,{path:"/bookings",children:e?Object(b.jsx)(w,{}):Object(b.jsx)(o.a,{to:"/auth"})})]})})]})};s.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(p,{children:Object(b.jsx)(S,{})})}),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.c5019fb5.chunk.js.map